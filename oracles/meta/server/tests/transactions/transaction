#!/usr/bin/env python3

from utils import *

with Meta() as meta:
  alice = User(meta, "alice@infinit.io")
  bob = User(meta, "bob@infinit.io")

  bob.login()

  transaction, res = bob.sendfile(recipient = alice.id,
                                  use_identifier = False)
  transaction_id = res['created_transaction_id']

  alice.login()

  res = alice.get('transaction/%s' % transaction_id)

  for key in transaction.keys():
    if key in ['id_or_email', 'device_id']: # Special cases.
      continue
    assertEq(res[key], transaction[key])
  assertEq(res['recipient_id'], transaction['recipient_id'])

  # Over limit for basic user.
  try:
    transaction, res = alice.sendfile(recipient = bob.id,
                                      total_size = 20 * 1000 * 1000 * 1000,
                                      initialize = True)
  except HTTPException as e:
    assert e.status == 402
    e.content['error'] == error.FILE_TRANSFER_SIZE_LIMITED[0]
    e.content['reason'] == error.FILE_TRANSFER_SIZE_LIMITED[1]
