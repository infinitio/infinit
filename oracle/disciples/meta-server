#!/usr/bin/env python2.7
from __future__ import print_function


"""Meta server provide a JSON-RPC API to infinit
users, networks and devices managment.

"""

import os
import sys
import argparse

sys.path.insert(0, os.path.join(os.path.dirname(__file__), "../lib/python"))

import meta.conf

parser = argparse.ArgumentParser(description="Meta server")

parser.add_argument(
    '--meta-host',
    default = meta.conf.META_HOST,
)
parser.add_argument(
    '--meta-port',
    type = int,
    default = meta.conf.META_PORT,
)

parser.add_argument(
    '--mongo-host',
    help = 'The MongoDB host to connect to',
    default = meta.conf.MONGO_HOST,
)

parser.add_argument(
    '--mongo-port',
    help = 'The MongoDB port to connect to',
    type = int,
    default = meta.conf.MONGO_PORT,
)

parser.add_argument(
    '--trophonius-control-port',
    type = int,
    default = meta.conf.TROPHONIUS_CONTROL_PORT,
)

parser.add_argument(
    '--apertus-host',
    type = str,
    default = meta.conf.APERTUS_HOST
)

parser.add_argument(
    '--apertus-port',
    type = int,
    default = meta.conf.APERTUS_PORT
)

parser.add_argument(
    '--port-file',
    default = 'meta_port_file',
)

parser.add_argument(
    '--fcgi',
    default = False,
    action = 'store_true',
)

from meta.application import Application

if __name__ == '__main__':
    args = parser.parse_args()
    try:
        app = Application(meta_host=args.meta_host,
                          meta_port=args.meta_port,
                          mongo_host=args.mongo_host,
                          mongo_port=args.mongo_port,
                          apertus_host=args.apertus_host,
                          apertus_port=args.apertus_port,
                          tropho_control_port=args.trophonius_control_port,
                          port_file=args.port_file,
                          fcgi = args.fcgi,
                      )
        app.run()
    except KeyboardInterrupt:
        print("Interrupted cleanly")
