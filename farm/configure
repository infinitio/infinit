#!/usr/bin/env python3

import os

arch, osyst, compiler = os.environ['BUILDFARM_NAME'].split('-')

template = '''\
import os, sys
sys.path.insert(
    0,
    os.path.abspath(
        os.path.join(os.path.dirname(__file__),
        '../source/elle/drake/src')
    )
)

import drake
import drake.cxx
import drake.cxx.boost

cxx_toolkit = drake.cxx.GccToolkit()
cxx_config = drake.cxx.Config()

boost = %(boost)s
python3 = %(python3)s

cxx_config.flag('-Wall')
cxx_config.flag('-W')
cxx_config.enable_debug_symbols()
cxx_config.enable_optimization(False)

drake.run('../%(dir_source)s', cxx_toolkit, cxx_config, boost = boost, python3 = python3)
'''

params = {
    'dir_build': os.environ['DIR_BUILD'],
    'dir_source': os.environ['DIR_SOURCE'],
    'boost': 'None',
    'python3': 'None',
}

if osyst.startswith('macosx'):
  params['boost'] = '''drake.cxx.boost.Boost(prefix = '/opt/local')'''
  params['python3'] = '\'/opt/local/Library/Frameworks/Python.framework/Versions/3.2\''

with open('%s/drake' % os.environ['DIR_BUILD'], 'w') as drake:
  print(template % params, file = drake)
